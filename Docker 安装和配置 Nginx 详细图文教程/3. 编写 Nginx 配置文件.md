## 3. 编写 Nginx 配置文件

在 `/mnt/nginx/conf` 目录下创建一个自定义的 Nginx 配置文件，执行以下命令：



```
![3.1](F:\Coding\Github\aioveu-vue3-element-admin-doc\Docker 安装和配置 Nginx 详细图文教程\3.1.png)sudo touch /mnt/nginx/conf/nginx.conf


#赋予配置文件权限
sudo chmod +777 /mnt/nginx/conf
sudo chmod +777 /mnt/nginx/conf/nginx.conf
```



![](F:\Coding\Github\aioveu-vue3-element-admin-doc\Docker 安装和配置 Nginx 详细图文教程\3.1.png)





接下来，使用以下配置来部署aioveu-vue3-element-admin项目的前端应用，并代理后端 API：

```
worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;

    # 开启gzip
    gzip on;
    gzip_http_version 1.1;
    gzip_disable "MSIE [1-6]\.";
    gzip_min_length 1k;
    gzip_buffers 16 64k;
    gzip_comp_level 5;
    gzip_vary on;
    gzip_types text/plain application/javascript text/css;

    server {
        listen 80;
        server_name _;  # 通配符匹配所有域名/IP
        #server_name your-server-ip; # 替换为服务器实际公网IP
        # server_name localhost;   # ← 这是关键问题所在  Host 头为 localhost 的请求 或直接访问 http://localhost 的请求 不响应
        # 通过 IP 或其他域名访问的请求
        location / {
        	# 指定前端静态资源路径
            # 需将 vue3-element-admin 项目构建后的 dist 目录拷贝至 /usr/share/nginx/html
            root /usr/share/nginx/html;
            index index.html index.htm;
        }

        # 代理后端 API 请求
        location /prod-api/ {
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            # 后端服务地址，注意保留 URL 末尾的 `/`
            proxy_pass https://192.168.25.21:8989/;
        }
    }
}

```



![](F:\Coding\Github\aioveu-vue3-element-admin-doc\Docker 安装和配置 Nginx 详细图文教程\3.2.png)



这是一个用于同时服务前端静态资源并反向代理后端 API 的配置

#### 全局配置

- `worker_processes 1;`：指定 Nginx 使用 **1个工作进程**（适合低负载场景，可考虑增加或设置为`auto`）
- `events { worker_connections 1024; }`：每个进程允许 **1024个并发连接**

#### HTTP 模块

1. **基础配置**
   - `include mime.types;`：包含 MIME 类型映射文件（如扩展名与 Content-Type 的映射）
   - `default_type application/octet-stream;`：默认响应类型为二进制流
   - `sendfile on;`：启用高效文件传输
   - `keepalive_timeout 65;`：客户端保持连接超时时间为65秒
2. **Gzip 压缩**
   已开启 Gzip 并针对文本类型文件压缩，优化前端资源加载速度。

#### Server 模块

1. **前端服务**

   ```
   location / {
       root /usr/share/nginx/html/vue; # 注意：这里是root而非alias  # 前端资源路径
       index index.html index.htm;
   }
   ```

   - **关键路径**：前端资源存放在容器的 `/usr/share/nginx/html/vue` 目录
     ⚠️ 根据Docker 挂载设置(`-v /mnt/nginx/html:/usr/share/nginx/html`)，该目录对应宿主机路径为：
     `/mnt/nginx/html`
     **请确保构建后的前端项目在此路径下，且包含`index.html`**

2. **API 代理**

   ```
   location /prod-api/ {
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_pass https://192.168.25.21:8989/;
   }
   ```

   - **代理规则**：所有访问 `/prod-api/` 的请求将被转发至 `https://192.168.25.21:8989`
     （例如：`http://your-domain.com/prod-api/login` → `https://192.168.25.21:8989/login`）
   - **保留原始请求信息**：通过 `X-Real-IP` 和 `X-Forwarded-For` 传递客户端真实 IP  , 正确保留了源请求 IP 地址

这个错误日志明确指出了问题所在：Nginx 配置文件中存在重复的 proxy_pass 指令。具体来说，在 /etc/nginx/nginx.conf 文件的第 39 行，
您定义了多个 proxy_pass 指令，这违反了 Nginx 的配置规则。

### 快速修复与部署步骤

1. **上传前端文件**
   将构建好的 `dist` 内容复制到宿主机：

   ```
   cp -r /path/to/dist/* /mnt/nginx/html/vue/
   ```

2. **测试配置**

   ```
   docker exec nginx nginx -t   # 测试语法
   # 应返回：configuration test is successful
   
   [root@localhost aioveu]# docker exec aioveu-nginx nginx -t
   nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
   nginx: configuration file /etc/nginx/nginx.conf test is successful
   ```

3. **重载配置**

   ```
   docker exec nginx nginx -s reload   重载配置
   
   docker exec aioveu-nginx nginx -s reload
   ```

4. **浏览器访问**

   - 首页：`http://服务器IP/`
   
   - API测试：`http://服务器IP/prod-api/`
   
     ```
     http://192.168.25.21/
     http://192.168.25.21/prod-api/
     ```
   
     

您的 Nginx 配置设计合理，用于同时服务 Vue 前端应用和反向代理后端 API



### 检查防火墙设置

```
# Ubuntu/Debian
sudo ufw status
sudo ufw allow 80/tcp

# CentOS/RHEL
sudo firewall-cmd --list-all
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --reload
```





```
[root@localhost aioveu]# sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: ens33
  sources: 
  services: ssh dhcpv6-client
  ports: 
  protocols: 
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 

[root@localhost aioveu]# sudo firewall-cmd --permanent --add-port=80/tcp
success
[root@localhost aioveu]# sudo firewall-cmd --reload
success
[root@localhost aioveu]# 
```

